# Default values for tatarlang-chart
# This is a YAML-formatted file.

global:
  namespace: tatarlang
  appName: tatarlang

# Namespace configuration
namespace:
  create: true
  name: tatarlang

# Backend configuration
backend:
  enabled: true
  image:
    repository: tatarlang-backend
    tag: latest
    pullPolicy: IfNotPresent
  replicas: 1
  service:
    type: ClusterIP
    port: 8000
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  readinessProbe:
    httpGet:
      path: /api/v1/
      port: 8000
    initialDelaySeconds: 20
    periodSeconds: 10
  livenessProbe:
    httpGet:
      path: /api/v1/
      port: 8000
    initialDelaySeconds: 60
    periodSeconds: 30

# Frontend configuration
frontend:
  enabled: true
  image:
    repository: tatarlang-frontend
    tag: latest
    pullPolicy: IfNotPresent
  replicas: 1
  service:
    type: ClusterIP
    port: 3000
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "15"
  replicas: 1
  persistence:
    enabled: true
    size: 1Gi
    storageClass: ""
    accessMode: ReadWriteOnce
  service:
    type: ClusterIP
    port: 5432
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# RabbitMQ configuration (using Bitnami chart)
rabbitmq:
  enabled: true
  # Bitnami chart configuration
  # Note: existingPasswordSecret will be dynamically set by the secret template
  # The secret name format is: <release-name>-rabbitmq
  auth:
    existingPasswordSecret: ""  # Will be set dynamically in template
    existingPasswordSecretKeys:
      adminPasswordKey: rabbitmq-password
      adminUsernameKey: rabbitmq-username
  service:
    type: LoadBalancer
    annotations: {}
    # For Yandex Cloud, uncomment and set:
    # yandex.cloud/load-balancer-type: "external"
    # yandex.cloud/subnet-id: "your-subnet-id"
  ingress:
    enabled: true
    ingressClassName: nginx
    hostname: rabbitmq.tatarlang.local
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    tls: true
    extraTls:
      - hosts:
          - rabbitmq.tatarlang.local
        secretName: rabbitmq-tls
    path: /
    pathType: Prefix
  persistence:
    enabled: true
    size: 8Gi
    storageClass: ""
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Celery configuration
celery:
  worker:
    enabled: true
    replicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
  beat:
    enabled: true
    replicas: 1
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi

# Jobs configuration
jobs:
  migrate:
    enabled: true
  clearsessions:
    enabled: true
    schedule: "0 3 * * *"

# External services
externalServices:
  smtp:
    enabled: true
    externalName: smtp.yandex.ru

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: tatarlang.local
      paths:
        - path: /api/
          pathType: Prefix
          service: backend
          servicePort: 8000
        - path: /
          pathType: Prefix
          service: frontend
          servicePort: 3000
  tls:
    - secretName: tatarlang-tls
      hosts:
        - tatarlang.local

# ConfigMap values
config:
  postgres:
    db: tatarlang
    host: db
    port: "5432"
  django:
    settingsModule: tatarlang.settings
  frontend:
    apiUrl: "https://tatarlang.local/api/v1"

# Environment file configuration (.env from ConfigMap)
# Note: Sensitive values are loaded via Secret envFrom in deployments
env:
  enabled: true

# Secrets - these should be replaced with vault refs when vault.enabled=true
secrets:
  postgres:
    user: "postgres"
    password: "postgres"
  rabbitmq:
    user: "admin"
    password: "admin"
  celery:
    brokerUrl: "amqp://admin:admin@rabbitmq:5672//"

# Vault integration (for Part 2)
vault:
  enabled: false
  address: "http://vault.vault.svc.cluster.local:8200"
  roleId: ""
  secretId: ""
  path: "secret/data/tatarlang"
  # Vault references using vals format
  refs:
    postgres:
      user: "ref+vault://secret/tatarlang/db#POSTGRES_USER"
      password: "ref+vault://secret/tatarlang/db#POSTGRES_PASSWORD"
    rabbitmq:
      user: "ref+vault://secret/tatarlang/rabbitmq#RABBITMQ_USER"
      password: "ref+vault://secret/tatarlang/rabbitmq#RABBITMQ_PASS"
    celery:
      brokerUrl: "ref+vault://secret/tatarlang/celery#CELERY_BROKER_URL"

